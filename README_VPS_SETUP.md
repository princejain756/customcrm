# Complete Ubuntu VPS Setup for CRM Application

This repository contains everything you need to deploy your CRM application on an Ubuntu VPS with PostgreSQL database, Node.js server, and React frontend.

## 📋 Quick Start

### Option 1: Automated Setup (Recommended)

1. **Clone this repository to your Ubuntu VPS:**
   ```bash
   git clone <your-repo-url> crm-setup
   cd crm-setup
   ```

2. **Run the automated installation script:**
   ```bash
   chmod +x setup_scripts/install.sh
   ./setup_scripts/install.sh <your-git-repo-url>
   ```

3. **Set up SSL certificate:**
   ```bash
   sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
   ```

4. **Start the application:**
   ```bash
   cd /home/crmuser/crm-app
   pm2 start ecosystem.config.js
   pm2 save
   ```

### Option 2: Manual Setup

Follow the detailed guide in `UBUNTU_VPS_SETUP.md` for step-by-step manual installation.

## 📁 File Structure

```
├── UBUNTU_VPS_SETUP.md          # Complete manual setup guide
├── setup_scripts/
│   ├── install.sh               # Automated installation script
│   ├── setup_database.sql       # Database schema and sample data
│   └── deploy.sh                # Quick deployment script
└── README_VPS_SETUP.md          # This file
```

## 🚀 Features Included

### ✅ Complete Stack
- **Frontend**: React with TypeScript, Vite, Tailwind CSS
- **Backend**: Node.js with Express
- **Database**: PostgreSQL 15
- **Web Server**: Nginx with SSL
- **Process Manager**: PM2
- **SSL**: Let's Encrypt with Certbot

### ✅ Security Features
- Firewall configuration (UFW)
- SSH key authentication
- Fail2ban protection
- Security headers
- Database user isolation

### ✅ Monitoring & Maintenance
- PM2 process monitoring
- Automated backups
- Log management
- Performance optimization
- Health checks

### ✅ Database Features
- Complete CRM schema
- Sample data for testing
- Optimized indexes
- Dashboard statistics view
- Automated triggers

## 🔧 Configuration

### Environment Variables

The setup creates a `.env` file with the following configuration:

```env
# Server Configuration
PORT=3001
NODE_ENV=production

# Database Configuration
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=autocrm
POSTGRES_USER=crmuser
POSTGRES_PASSWORD=<auto-generated>

# JWT Configuration
JWT_SECRET=<auto-generated>

# CORS Configuration
CORS_ORIGIN=https://yourdomain.com

# File Upload Configuration
UPLOAD_PATH=/home/crmuser/crm-app/uploads
MAX_FILE_SIZE=10485760
```

### Default Access

- **Admin User**: `admin@example.com` / `admin123`
- **Database**: PostgreSQL on localhost:5432
- **Application**: https://yourdomain.com
- **SSH**: `ssh crmuser@your-server-ip`

## 📊 Database Schema

The setup includes a complete CRM database with:

### Core Tables
- `organisations` - Company information
- `users` - User accounts and roles
- `customers` - Customer management
- `products` - Product catalog
- `orders` - Order management
- `order_items` - Order line items
- `leads` - Lead management
- `lead_activities` - Lead tracking
- `scanned_bills` - Bill scanning
- `notifications` - User notifications

### Sample Data
- Default organization
- Admin user account
- Sample customers, products, leads, and orders
- Test data for all major features

## 🔄 Deployment

### Quick Update
```bash
# Run as crmuser
sudo -u crmuser /home/crmuser/crm-app/setup_scripts/deploy.sh
```

### Manual Update
```bash
cd /home/crmuser/crm-app
git pull origin main
npm install
npm run build
pm2 restart all
pm2 save
```

## 📈 Monitoring

### Check Application Status
```bash
pm2 status
pm2 logs
pm2 monit
```

### Check Services
```bash
sudo systemctl status nginx
sudo systemctl status postgresql
sudo systemctl status fail2ban
```

### View Logs
```bash
# Application logs
pm2 logs

# Nginx logs
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# Database logs
sudo tail -f /var/log/postgresql/postgresql-15-main.log
```

## 🔒 Security

### SSH Configuration
- Port changed to 2222
- Root login disabled
- Password authentication disabled
- Key-based authentication only

### Firewall Rules
- SSH: Port 2222
- HTTP: Port 80
- HTTPS: Port 443
- All other ports blocked

### Database Security
- Separate database user
- Limited permissions
- Local access only
- Secure password generation

## 💾 Backup

### Automated Backups
- Daily database backups
- 7-day retention
- Compressed storage
- Cron job automation

### Manual Backup
```bash
/home/crmuser/backup.sh
```

### Restore Database
```bash
gunzip -c /home/crmuser/backups/db_backup_YYYYMMDD_HHMMSS.sql.gz | psql -h localhost -U crmuser -d autocrm
```

## 🛠️ Troubleshooting

### Common Issues

#### 1. Application Not Starting
```bash
pm2 logs crm-api
sudo netstat -tlnp | grep :3001
```

#### 2. Database Connection Issues
```bash
psql -h localhost -U crmuser -d autocrm
sudo systemctl status postgresql
```

#### 3. Nginx Issues
```bash
sudo nginx -t
sudo tail -f /var/log/nginx/error.log
```

#### 4. SSL Certificate Issues
```bash
sudo certbot certificates
sudo certbot renew
```

### Performance Optimization

#### PostgreSQL Tuning
```bash
sudo nano /etc/postgresql/15/main/postgresql.conf
```

Add these optimizations:
```
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 4MB
maintenance_work_mem = 64MB
```

#### Nginx Optimization
```bash
sudo nano /etc/nginx/nginx.conf
```

Add to http block:
```
client_max_body_size 10M;
client_body_timeout 60s;
keepalive_timeout 65s;
```

## 📞 Support

### Maintenance Commands
```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Restart services
sudo systemctl restart nginx postgresql

# Check disk space
df -h

# Monitor resources
htop

# View recent errors
pm2 logs --err --lines 50
```

### Emergency Procedures

#### Restart Everything
```bash
sudo systemctl restart nginx postgresql
pm2 restart all
```

#### Check All Services
```bash
sudo systemctl status nginx postgresql fail2ban
pm2 status
```

#### View All Logs
```bash
pm2 logs
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/postgresql/postgresql-15-main.log
```

## 📝 License

This setup is provided as-is for educational and commercial use. Please ensure you comply with all applicable licenses for the included software components.

## 🤝 Contributing

To improve this setup:

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## 📚 Additional Resources

- [Ubuntu Server Guide](https://ubuntu.com/server/docs)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Nginx Documentation](https://nginx.org/en/docs/)
- [PM2 Documentation](https://pm2.keymetrics.io/docs/)
- [Let's Encrypt Documentation](https://letsencrypt.org/docs/)

---

**Happy Deploying! 🚀**

Your CRM application should now be running securely on your Ubuntu VPS with all the necessary components for production use. 